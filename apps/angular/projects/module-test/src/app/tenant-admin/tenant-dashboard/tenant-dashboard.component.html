<div class="container-fluid mt-4">
  @if (loading) {
    <div class="text-center">
      <div class="spinner-border" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  } @else if (error) {
    <div class="alert alert-danger">
      {{ error }}
    </div>
  } @else if (dashboard) {
    <!-- Header -->
    <div class="row mb-4">
      <div class="col-12">
        <h2>Welcome to {{ dashboard.tenantName }}</h2>
        <p class="text-muted">Manage your subscription and view your account details</p>
      </div>
    </div>

    <!-- Subscription Overview -->
    <div class="row g-4 mb-4">
      <div class="col-md-6 col-lg-3">
        <div class="card">
          <div class="card-body">
            <h6 class="card-subtitle mb-2 text-muted">Current Plan</h6>
            <h4 class="card-title">{{ dashboard.editionName }}</h4>
          </div>
        </div>
      </div>
      
      <div class="col-md-6 col-lg-3">
        <div class="card">
          <div class="card-body">
            <h6 class="card-subtitle mb-2 text-muted">Status</h6>
            <h4 class="card-title">
              <span class="badge" [ngClass]="getStatusBadgeClass(dashboard.subscriptionStatus)">
                {{ dashboard.subscriptionStatus }}
              </span>
            </h4>
          </div>
        </div>
      </div>
      
      <div class="col-md-6 col-lg-3">
        <div class="card">
          <div class="card-body">
            <h6 class="card-subtitle mb-2 text-muted">Next Billing Date</h6>
            <h4 class="card-title">{{ dashboard.nextBillingDate | date:'mediumDate' }}</h4>
          </div>
        </div>
      </div>
      
      <div class="col-md-6 col-lg-3">
        <div class="card">
          <div class="card-body">
            <h6 class="card-subtitle mb-2 text-muted">Current Price</h6>
            <h4 class="card-title">
              {{ dashboard.currentPrice.currency }} {{ dashboard.currentPrice.amount }}
            </h4>
            <small class="text-muted">{{ dashboard.billingPeriod }}</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Feature Limits -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">Feature Limits</h5>
          </div>
          <div class="card-body">
            @if (getFeatureLimitKeys().length > 0) {
              <div class="row">
                @for (feature of getFeatureLimitKeys(); track feature) {
                  <div class="col-md-6 col-lg-4 mb-3">
                    <div class="d-flex justify-content-between align-items-center">
                      <span class="fw-medium">{{ feature }}</span>
                      <span class="badge bg-primary">{{ dashboard.featureLimits[feature] }}</span>
                    </div>
                  </div>
                }
              </div>
            } @else {
              <p class="text-muted mb-0">No feature limits defined</p>
            }
          </div>
        </div>
      </div>
    </div>

    <!-- Subscription Details -->
    <div class="row mb-4">
      <div class="col-md-6">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">Subscription Details</h5>
          </div>
          <div class="card-body">
            <table class="table table-sm">
              <tbody>
                <tr>
                  <th>Start Date:</th>
                  <td>{{ dashboard.subscriptionStartDate | date:'mediumDate' }}</td>
                </tr>
                <tr>
                  <th>End Date:</th>
                  <td>{{ dashboard.subscriptionEndDate | date:'mediumDate' }}</td>
                </tr>
                <tr>
                  <th>Billing Period:</th>
                  <td>{{ dashboard.billingPeriod }}</td>
                </tr>
                <tr>
                  <th>Auto Renew:</th>
                  <td>
                    <span [ngClass]="dashboard.autoRenew ? 'text-success' : 'text-danger'">
                      {{ dashboard.autoRenew ? 'Enabled' : 'Disabled' }}
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Recent Invoices -->
      <div class="col-md-6">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Recent Invoices</h5>
            <a href="/tenant-admin/invoices" class="btn btn-sm btn-outline-primary">View All</a>
          </div>
          <div class="card-body">
            @if (invoices.length > 0) {
              <div class="list-group list-group-flush">
                @for (invoice of invoices; track invoice.id) {
                  <div class="list-group-item px-0">
                    <div class="d-flex justify-content-between align-items-center">
                      <div>
                        <div class="fw-medium">{{ invoice.invoiceNumber }}</div>
                        <small class="text-muted">{{ invoice.issueDate | date:'shortDate' }}</small>
                      </div>
                      <div class="text-end">
                        <div class="fw-bold">{{ invoice.amount.currency }} {{ invoice.amount.amount }}</div>
                        <span class="badge" [ngClass]="getStatusBadgeClass(invoice.status)">
                          {{ invoice.status }}
                        </span>
                      </div>
                    </div>
                  </div>
                }
              </div>
            } @else {
              <p class="text-muted mb-0">No invoices yet</p>
            }
          </div>
        </div>
      </div>
    </div>
  }
</div>
